<ion-header class="transparent-header">
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/favorites"></ion-back-button>
    </ion-buttons>
    <ion-title class="ion-text-center">
      <strong>{{ favourite.name }}</strong>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleLanguage()">
        <ion-icon slot="icon-only" [name]="showEnglishTitles ? 'language-outline' : 'text-outline'"></ion-icon>
      </ion-button>
      <ion-button fill="solid" shape="round" color="medium" (click)="toggleEditMode()">
        <ion-icon slot="icon-only" [name]="editMode ? 'checkmark-outline' : 'create-outline'"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-no-padding">
  <div class="header-container">
    <div class="header-image" [style.background-image]="getBackgroundImageUrl()"></div>
    <div class="overlay">
      <div class="favorite-info">
        <div class="favorite-icon">
          <ion-icon name="heart"></ion-icon>
        </div>
        <h1 class="favorite-title">{{ favourite.name }}</h1>
        <div class="favorite-meta">
          <span class="favorite-date">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ favourite.id | date:'mediumDate' }}
          </span>
          <span class="hymn-count" *ngIf="(hymns$ | async) as hymns">
            <ion-icon name="musical-notes"></ion-icon>
            {{ hymns.length }} {{ showEnglishTitles ? (hymns.length === 1 ? 'Hymn' : 'Hymns') : 'Indirimbo' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="content-container">
    <ng-container *ngIf="(hymns$ | async) as hymns; else skeleton">
      <ng-container *ngIf="hymns.length > 0; else emptyList">
        <div class="hymns-wrapper">
          <ion-list class="hymn-list">
            <ion-item-sliding *ngFor="let hymn of hymns">
              <ion-item
                [routerLink]="['/tabs/favorites', favourite.id, 'hymns', hymn.number]"
                detail="true"
                button
                lines="none"
                class="hymn-item"
              >
                <div class="hymn-number-badge">
                  <div class="badge-number">{{ hymn.number }}</div>
                  <div class="badge-icon">
                    <ion-icon name="musical-note"></ion-icon>
                  </div>
                </div>
                <ion-label>
                  <h2>{{ hymn.title.kinyarwanda }}</h2>
                  <p *ngIf="hymn.title.english && showEnglishTitles" class="english-title">{{ hymn.title.english }}</p>
                  <div class="hymn-meta">
                    <span class="verse-count">
                      <ion-icon name="list-outline"></ion-icon>
                      {{ getVerseCount(hymn) }} {{ showEnglishTitles ? 'verses' : 'ibice' }}
                    </span>
                  </div>
                </ion-label>
                <ion-button *ngIf="editMode" fill="clear" slot="end" color="danger" (click)="removeHymnFromFavorite(hymn); $event.stopPropagation()">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </ion-item>
              <ion-item-options side="end">
                <ion-item-option color="danger" expandable (click)="removeHymnFromFavorite(hymn)">
                  <ion-icon slot="start" name="trash-outline"></ion-icon>
                  {{ showEnglishTitles ? 'Remove' : 'Kuraho' }}
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </ion-list>
        </div>
      </ng-container>
    </ng-container>

    <ng-template #emptyList>
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="musical-notes-outline"></ion-icon>
        </div>
        <h2>{{ showEnglishTitles ? 'No Hymns Yet' : 'Nta Ndirimbo' }}</h2>
        <p>{{ showEnglishTitles ? 'Add your favorite hymns to this list from any hymn page' : 'Ongeraho indirimbo mu rutonde rwawe' }}</p>
      </div>
    </ng-template>

    <ng-template #skeleton>
      <div class="loading-container">
        <ion-skeleton-text animated style="width: 100%; height: 80px; margin-bottom: 12px; border-radius: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 80px; margin-bottom: 12px; border-radius: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 80px; margin-bottom: 12px; border-radius: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 80px; margin-bottom: 12px; border-radius: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 80px; border-radius: 12px;"></ion-skeleton-text>
      </div>
    </ng-template>
  </div>
</ion-content>